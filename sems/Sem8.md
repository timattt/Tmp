# Семинар 8

## Docker

### Виртуализация

![image](https://github.com/timattt/Tmp/assets/25401699/2956345a-dd1e-4679-bd7a-c81431ba9a13)

* ВМ не знает о том, что она ВМ
* Докер выделяет пространство в хостовом линуксе - фактически новой ОС или ВМ не появляется

### Докер на разных ОС

* линукс - из коробки
* на винде - wsl, docker desktop
* macos - ВМ

### Докер основное

* Докер — это открытая платформа для разработки, доставки и эксплуатации приложений
* С помощью docker вы можете отделить ваше приложение от вашей инфраструктуры и обращаться с инфраструктурой как управляемым приложением
* В докере можно запустить любое unix-приложение
* Приложение в докере в любом месте запускается одинаково

### Сущности

* Докер-клиент - программа для общения с демоном через REST_API
* Докер-демон - делает всю работу ```systemctl start docker```
* образ - снапшот ВМ
* контейнер - запущенный и работающий в данный момент образ
* реестр - хранилище образов

### Образа и докерфайлы

* Образ состоит из слоев
* Каждая команда = новый слой
* образ можно создать из докер-файла
* Докер-файл берет образ, добавляет в него слои и на выходе выдает новый образ
* Сборка докер-файла происходит последовательно - слой за слоем

### Классический сценарий использования в разработке

1. Пишем код
2. Для тестирования запускаем debug-окружение в докере (БД, Кеш...)
3. делаем пуш в гитхаб
4. ci/cd в докере собирает и тестирует приложение
5. потом ci/cd собирает продуктовый образ приложения
6. образ загружается в геристри (докер-хаб)
7. образ разворачивается в продуктовом окружении

### Простой докерфайл для java

```
FROM openjdk:17-jdk-alpine
COPY target/docker-java-jar-0.0.1-SNAPSHOT.jar app.jar
ENTRYPOINT [ "java", "-jar", "/app.jar" ]
```

### Команды в докерфайле

* from - базовый образ
* run - запустить команду
* copy/add - скопировать файлы в образ
* user - изменить пользователя
* workdir - указать рабочий каталог для пользователя
* entrypoint - стартовая команда для запуска (в команде docker run будут подставляться аргументы именно к этому скрипту)
* env - установить переменную окружения

### команды докера

* Build an Image from a Dockerfile ```docker build -t <image_name> ```
* Create and run a container from an image ```docker run <image_name>```
* commit a container's file changes or settings into a new image ```docker container commit CONTAINER_ID IMAGE_NAME```
* Pull an image from a Docker Hub ```docker pull <image_name>```
* Publish an image to Docker Hub ```docker push <username>/<image_name>```
* list currently running containers ```docker ps```

### Параметры docker run

* -d запускаем контейнер в фоновом режиме, не занимая терминал
* --env VAR1=value1 установить переменную окружения
* -it интерактивное взаимодействие с IO контейнера. Фактически прямой доступ к bash внутри контейнера
* -v HOST_PATH:CONTAINER_PATH - маунтим директорию внутрь контейнера




