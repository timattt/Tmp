# web-приложение для тестов на паре

*аналог kahoot*

## Общее описание

Сайт, на котором можно запустить тест для нескольких человек. Причем условие вопроса участникам не показывается в их браузерах.
Оно показывается только в браузере создателя теста. Такой механизм нужен, чтобы проводить тесты в аудитории, таким образом,
чтобы только те, кто есть на месте могли бы его проходить.

## Пользовательские потребности

Пользователь хочет:

* Создать простой тест на сайте, установить время его начала, получить на него ссылку, в момент прохождения иметь окно браузера, которое будет показывать условия теста (если эта фича используется), после окончания теста увижеть результаты.
* Перейти по ссылке на тест, залогиниться, начать его проходить, в каждый момент времени видеть ровно один вопрос (если отключена фича отображения вопроса только у хоста) и варианты ответа на него.

## Пользовательские сценарии

* Зайти на сайт и залогиниться.
* Создать тест: указать вопросы, время начала, галка - нужно ли скрывать вопросы от участников, указать - является ли тест публичным. После получить ссылку на прохождение.
* Присоединиться к тесту: перейти по ссылке, увидеть информацию о тесте (имя, время, длительность, кол участников) и нажать кнопку присоединиться.
* Увидеть вопрос: если пользователь проходит тест, то он может увидеть текущий вопрос (если только нет фичи со скрытием условия от участников) и варианты ответа. Причем если время ответа прошло - увидеть и ответить нельзя. Также при успешном запросе - можно узнать id вопроса.
* Ответить на вопрос: пользователь может ответить на текущий вопрос теста. Ограничения времени тоже актуальны.
* Обозреть список тестов: пользователь может увидеть список тестов: публичных; которые он прошел; на которые зарегался;
* Увидеть результаты пройденного теста: пользователь может посмотреть результаты прохождения теста.

## Предметная область

### Сущности

#### Тест

* id **пользователя** создателя
* время начала
* список **вопросов**
* галка: публичный или нет
* галка: аудиторный или нет
* время на один вопрос
* список **участников**

#### Вопрос

* **тест**
* условие вопроса
* id правильного **варианта ответа на вопрос**
* список возможных **варианта ответов на вопрос**

#### Вариант ответа на вопрос

* **вопрос**
* текст варианта

#### Попытка теста

* **id пользователя**
* **тест**
* список **ответов на вопрос**

#### Ответ на вопрос

* **попытка теста**
* **вопрос**
* выбранный **вариант ответа на вопрос**

#### Результат прохождения теста

* **id пользователя**
* **тест**
* число - кол правильных ответов

## Публичные системные операции

### ```POST /test```

Создать тест - указать все нужные параметры, получить обратно ссылку на тест.
Создается новая сущность **тест** и сохраняется в *БД*.

### ```GET /test/{id}```

Получить инфу о тесте, в том числе о пройденном.
Из *БД* извлекается сущность **тест**.

### ```POST /test/{id}/join```

Присоединиться к тесту.
Создается новая сущность **попытка теста** и кладется в *кеш*.
 
### ```GET /test/{id}/question```

Получить текущий вопрос.
Возвращает сущность **вопрос** и к нему связанные **варианты ответа на вопрос**.
Причем это работает только, когда тест идет - оно вернет вопрос, на который можно ответить в данный момент.

### ```POST /question/{id}```

Ответить на вопрос.
Создает сущность **ответ на вопрос** и кладет ее в *кеш*.

### ```GET /test```

Увидеть список доступных тестов.
Возвращает список сущностей **тест**, которые доступны пользователю в данный момент исходя из его прав.
Публичные тесты видны всем. Непубличные видны только тем, кто присоединился туда.

## Фоновые системные операции

### Окончание теста

Запускается для каждой сущности **тест** единоразово в момент, когда: ```currentTime > test.startTime + test.questionsCount * test.questionTime```.
Вся информация о данном тесте, которая лежала в кеше оттуда удаляется. Происходит подсчет правильных ответов и он кладется в БД как сущность **Результат прохождения теста** для каждого пользователя.

## Разбиение на сервисы

### TestService

Весь сервис покрывает единственный агрегат с корнем в сущности ```тест```.
В него входят все вышеперечисленные системные операции.

## Бизнес логика

Так как проект маленький - используем паттерн сценарии транзакции.



